{"ast":null,"code":"var _jsxFileName = \"/home/adamadziev/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/projects on GitHub/react-pizza/src/pages/Home.jsx\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nimport qs from \"qs\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { fetchPizzas, selectPizzaData } from \"../redux/slices/pizzaSlice\";\nimport { selectFilter, setCategoryId, setCurrentPage, setFilters } from \"../redux/slices/filterSlice\";\nimport Categories from \"../components/Categories\";\nimport Sort, { sortList } from \"../components/Sort\";\nimport PizzaBlock from \"../components/PizzaBlock\";\nimport Skeleton from \"../components/PizzaBlock/Skeleton\"; // import Pagination from \"../components/Pagination\";\n\nimport Pagination2 from \"../components/Pagination2\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction Home() {\n  _s();\n\n  const navigate = useNavigate();\n  const dispatch = useDispatch(); // useSelector говорит: дай мне ф-цию и в нее я передам тебе стейт, дальше уже мы вытаскиваем из стейта что нам нужно\n\n  const {\n    categoryId,\n    currentPage,\n    sort,\n    searchValue\n  } = useSelector(selectFilter); // state - наше хранилище(store), из него достаем что нам нужно\n\n  const {\n    items,\n    status\n  } = useSelector(selectPizzaData);\n  const isSearch = React.useRef(false); // Пришли ли параметры из URL\n\n  const isMounted = React.useRef(false); // Был ли первый рендер\n  // У каждой пиццы есть категории к которым она относится, категория 0 есть у всех, это все пиццы\n  // категория 1 - мясные, 2 - вегатерианская и тд, и мы пишем у пиццы те категории к которым она относится\n\n  const limitPizzasPage = 4;\n\n  const onChangeCategory = id => {\n    dispatch(setCategoryId(id));\n  };\n\n  const getPizzas = async () => {\n    const order = sort.order ? sort.order : \"desc\";\n    dispatch(fetchPizzas({\n      categoryId,\n      sort,\n      currentPage,\n      limitPizzasPage,\n      order\n    }));\n    window.scrollTo(0, 0); // Если страница загрузилась впервые делаем скрол наверху\n  }; // Если изменили параметры и был первый рендер, то выполнится\n\n\n  React.useEffect(() => {\n    // Превращает объект в строку - soryBy=rating&categoryId=0&currentPage=1\n    if (isMounted.current) {\n      const queryString = qs.stringify({\n        sortBy: sort.sortProperty,\n        categoryId,\n        currentPage,\n        order: sort.order\n      });\n      navigate(`?${queryString}`); // Вшивает аргумент в адресную строку\n    }\n\n    isMounted.current = true;\n  }, [categoryId, sort, currentPage]); // Если был первый рендер, то проверяем URL-параметры и сохраняем их в redux\n\n  React.useEffect(() => {\n    if (window.location.search) {\n      const params = qs.parse(window.location.search.substring(1)); // Извлекаем \"?\"\n\n      const sort = sortList.find(list => {\n        if (params.order) {\n          return list.sortProperty === params.sortBy && list.order === params.order;\n        }\n\n        return list.sortProperty === params.sortBy;\n      });\n      dispatch(setFilters({ ...params,\n        sort\n      }));\n      isSearch.current = true;\n    }\n  }, []);\n  React.useEffect(() => {\n    // Если нет URL-параметров, то выполнится\n    if (!isSearch.current) {\n      getPizzas();\n    }\n\n    isSearch.current = false;\n  }, [categoryId, sort, currentPage, searchValue]); // useEffect будет выполняться при изменении categoryID\n\n  const skeletons = [...Array(4)].map((_, index) => /*#__PURE__*/_jsxDEV(Skeleton, {}, index, false, {\n    fileName: _jsxFileName,\n    lineNumber: 108,\n    columnNumber: 53\n  }, this));\n  const pizzas = items.filter(item => item.title.toLowerCase().includes(searchValue.toLowerCase())).map(item => {\n    return /*#__PURE__*/_jsxDEV(PizzaBlock, { ...item\n    }, item.id, false, {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 14\n    }, this);\n  });\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"content__top\",\n      children: [/*#__PURE__*/_jsxDEV(Categories, {\n        value: categoryId,\n        onChangeCategory: i => onChangeCategory(i)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Sort, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n      className: \"content__title\",\n      children: \"\\u0412\\u0441\\u0435 \\u043F\\u0438\\u0446\\u0446\\u044B\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 7\n    }, this), status === \"error\" ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"content__error-info\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"\\u041F\\u0440\\u043E\\u0438\\u0437\\u043E\\u0448\\u043B\\u0430 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0430\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"\\u041A \\u0441\\u043E\\u0436\\u0430\\u043B\\u0435\\u043D\\u0438\\u044E \\u043D\\u0435 \\u0443\\u0434\\u0430\\u043B\\u043E\\u0441\\u044C \\u043F\\u043E\\u043B\\u0443\\u0447\\u0438\\u0442\\u044C \\u043F\\u0438\\u0446\\u0446\\u044B. \\u041F\\u043E\\u043F\\u0440\\u043E\\u0431\\u0443\\u0439\\u0442\\u0435 \\u043F\\u043E\\u0432\\u0442\\u043E\\u0440\\u0438\\u0442\\u044C \\u043F\\u043E\\u043F\\u044B\\u0442\\u043A\\u0443 \\u043F\\u043E\\u0437\\u0436\\u0435\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"content__items\",\n      children: status === \"loading\" ? skeletons : pizzas\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 9\n    }, this), status !== \"error\" ? /*#__PURE__*/_jsxDEV(Pagination2, {\n      currentPage: currentPage,\n      changePage: num => {\n        console.log(num);\n        dispatch(setCurrentPage(num));\n      },\n      pageCount: Math.ceil(10 / limitPizzasPage)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 9\n    }, this) : null]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 118,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Home, \"w3/Dtzt4fBW2Zbk0PWlCsLiuESo=\", false, function () {\n  return [useNavigate, useDispatch, useSelector, useSelector];\n});\n\n_c = Home;\nexport default Home;\n\nvar _c;\n\n$RefreshReg$(_c, \"Home\");","map":{"version":3,"names":["React","qs","useNavigate","useSelector","useDispatch","fetchPizzas","selectPizzaData","selectFilter","setCategoryId","setCurrentPage","setFilters","Categories","Sort","sortList","PizzaBlock","Skeleton","Pagination2","Home","navigate","dispatch","categoryId","currentPage","sort","searchValue","items","status","isSearch","useRef","isMounted","limitPizzasPage","onChangeCategory","id","getPizzas","order","window","scrollTo","useEffect","current","queryString","stringify","sortBy","sortProperty","location","search","params","parse","substring","find","list","skeletons","Array","map","_","index","pizzas","filter","item","title","toLowerCase","includes","i","num","console","log","Math","ceil"],"sources":["/home/adamadziev/Рабочий стол/projects on GitHub/react-pizza/src/pages/Home.jsx"],"sourcesContent":["import React from \"react\";\r\nimport qs from \"qs\";\r\nimport { useNavigate } from \"react-router-dom\";\r\n\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport { fetchPizzas, selectPizzaData } from \"../redux/slices/pizzaSlice\";\r\nimport {\r\n  selectFilter,\r\n  setCategoryId,\r\n  setCurrentPage,\r\n  setFilters,\r\n} from \"../redux/slices/filterSlice\";\r\n\r\nimport Categories from \"../components/Categories\";\r\nimport Sort, { sortList } from \"../components/Sort\";\r\nimport PizzaBlock from \"../components/PizzaBlock\";\r\nimport Skeleton from \"../components/PizzaBlock/Skeleton\";\r\n// import Pagination from \"../components/Pagination\";\r\nimport Pagination2 from \"../components/Pagination2\";\r\n\r\nfunction Home() {\r\n  const navigate = useNavigate();\r\n  const dispatch = useDispatch();\r\n\r\n  // useSelector говорит: дай мне ф-цию и в нее я передам тебе стейт, дальше уже мы вытаскиваем из стейта что нам нужно\r\n  const { categoryId, currentPage, sort, searchValue } =\r\n    useSelector(selectFilter); // state - наше хранилище(store), из него достаем что нам нужно\r\n  const { items, status } = useSelector(selectPizzaData);\r\n\r\n  const isSearch = React.useRef(false); // Пришли ли параметры из URL\r\n  const isMounted = React.useRef(false); // Был ли первый рендер\r\n\r\n  // У каждой пиццы есть категории к которым она относится, категория 0 есть у всех, это все пиццы\r\n  // категория 1 - мясные, 2 - вегатерианская и тд, и мы пишем у пиццы те категории к которым она относится\r\n\r\n  const limitPizzasPage = 4;\r\n\r\n  const onChangeCategory = (id) => {\r\n    dispatch(setCategoryId(id));\r\n  };\r\n\r\n  const getPizzas = async () => {\r\n    const order = sort.order ? sort.order : \"desc\";\r\n\r\n    dispatch(\r\n      fetchPizzas({\r\n        categoryId,\r\n        sort,\r\n        currentPage,\r\n        limitPizzasPage,\r\n        order,\r\n      })\r\n    );\r\n\r\n    window.scrollTo(0, 0); // Если страница загрузилась впервые делаем скрол наверху\r\n  };\r\n\r\n  // Если изменили параметры и был первый рендер, то выполнится\r\n  React.useEffect(() => {\r\n    // Превращает объект в строку - soryBy=rating&categoryId=0&currentPage=1\r\n    if (isMounted.current) {\r\n      const queryString = qs.stringify({\r\n        sortBy: sort.sortProperty,\r\n        categoryId,\r\n        currentPage,\r\n        order: sort.order,\r\n      });\r\n\r\n      navigate(`?${queryString}`); // Вшивает аргумент в адресную строку\r\n    }\r\n    isMounted.current = true;\r\n  }, [categoryId, sort, currentPage]);\r\n\r\n  // Если был первый рендер, то проверяем URL-параметры и сохраняем их в redux\r\n  React.useEffect(() => {\r\n    if (window.location.search) {\r\n      const params = qs.parse(window.location.search.substring(1)); // Извлекаем \"?\"\r\n\r\n      const sort = sortList.find((list) => {\r\n        if (params.order) {\r\n          return (\r\n            list.sortProperty === params.sortBy && list.order === params.order\r\n          );\r\n        }\r\n        return list.sortProperty === params.sortBy;\r\n      });\r\n\r\n      dispatch(\r\n        setFilters({\r\n          ...params,\r\n          sort,\r\n        })\r\n      );\r\n\r\n      isSearch.current = true;\r\n    }\r\n  }, []);\r\n\r\n  React.useEffect(() => {\r\n    // Если нет URL-параметров, то выполнится\r\n    if (!isSearch.current) {\r\n      getPizzas();\r\n    }\r\n\r\n    isSearch.current = false;\r\n  }, [categoryId, sort, currentPage, searchValue]); // useEffect будет выполняться при изменении categoryID\r\n\r\n  const skeletons = [...Array(4)].map((_, index) => <Skeleton key={index} />);\r\n  const pizzas = items\r\n    .filter((item) =>\r\n      item.title.toLowerCase().includes(searchValue.toLowerCase())\r\n    )\r\n    .map((item) => {\r\n      return <PizzaBlock key={item.id} {...item} />;\r\n    });\r\n\r\n  return (\r\n    <div className=\"container\">\r\n      <div className=\"content__top\">\r\n        <Categories\r\n          value={categoryId}\r\n          onChangeCategory={(i) => onChangeCategory(i)}\r\n        />\r\n        <Sort />\r\n      </div>\r\n      <h2 className=\"content__title\">Все пиццы</h2>\r\n      {status === \"error\" ? (\r\n        <div className=\"content__error-info\">\r\n          <h2>Произошла ошибка</h2>\r\n          <p>\r\n            К сожалению не удалось получить пиццы. Попробуйте повторить попытку\r\n            позже\r\n          </p>\r\n        </div>\r\n      ) : (\r\n        <div className=\"content__items\">\r\n          {status === \"loading\" ? skeletons : pizzas}\r\n        </div>\r\n      )}\r\n      {status !== \"error\" ? (\r\n        <Pagination2\r\n          currentPage={currentPage}\r\n          changePage={(num) => {\r\n            console.log(num);\r\n            dispatch(setCurrentPage(num));\r\n          }}\r\n          pageCount={Math.ceil(10 / limitPizzasPage)}\r\n        />\r\n      ) : null}\r\n      {/* <Pagination onChangePage={(number) => setCurrentPage(number)} /> */}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Home;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}